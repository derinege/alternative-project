<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GerÃ§ek ZamanlÄ± KonuÅŸma Ã‡eviri Sistemi</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0; 
            padding: 20px; 
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            padding: 30px; 
            backdrop-filter: blur(10px);
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .setup-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }
        .setup-section h3 {
            margin-top: 0;
            color: #495057;
        }
        .language-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            min-width: 150px;
        }
        .controls {
            text-align: center;
            margin: 25px 0;
        }
        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn-start {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        .btn-stop {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .status {
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .status.listening {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.stopped {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .transcript-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            border: 2px solid #e9ecef;
        }
        .transcript {
            font-size: 1.4em;
            color: #333;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .translation-container {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            border: 2px solid #bbdefb;
        }
        .translation {
            font-size: 1.4em;
            color: #1565c0;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .info-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        .speed-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ GerÃ§ek ZamanlÄ± KonuÅŸma Ã‡eviri Sistemi</h1>
        
        <div class="setup-section">
            <h3>ğŸŒ Ã‡eviri AyarlarÄ±</h3>
            <div id="micListBox" style="margin-bottom:15px;"></div>
            <div class="language-selector">
                <label><strong>Hedef Dil:</strong></label>
                <select id="targetLang">
                    <option value="en">ğŸ‡ºğŸ‡¸ Ä°ngilizce</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ Ä°spanyolca</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FransÄ±zca</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Almanca</option>
                    <option value="it">ğŸ‡®ğŸ‡¹ Ä°talyanca</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ Portekizce</option>
                    <option value="ru">ğŸ‡·ğŸ‡º RusÃ§a</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ Japonca</option>
                    <option value="ko">ğŸ‡°ğŸ‡· Korece</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ Ã‡ince</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ ArapÃ§a</option>
                </select>
                
                <label><strong>Ã‡eviri Servisi:</strong></label>
                <select id="translationService">
                    <option value="ollama">âš¡ Ollama (HÄ±zlÄ± Local AI)</option>
                    <option value="google">ğŸ” Google Translate</option>
                </select>
            </div>
            
            <div class="info-box">
                <strong>â„¹ï¸ NasÄ±l Ã‡alÄ±ÅŸÄ±r:</strong><br>
                1. Hedef dili seÃ§in<br>
                2. "ğŸ¤ Dinlemeye BaÅŸla" butonuna tÄ±klayÄ±n<br>
                3. TÃ¼rkÃ§e konuÅŸun - sistem anÄ±nda Ã§evirecek<br>
                <strong>âš¡ Ollama:</strong> Local AI ile sÄ±fÄ±r gecikme!
            </div>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="btn btn-start">ğŸ¤ Dinlemeye BaÅŸla</button>
            <button id="stopBtn" class="btn btn-stop" style="display:none;">â¹ï¸ Durdur</button>
        </div>
        
        <div id="status" class="status stopped">
            Hedef dili seÃ§in ve dinlemeye baÅŸlayÄ±n.
        </div>
        <div id="detectedLang" style="text-align:center;font-size:1.1em;color:#444;margin-bottom:10px;"></div>
        <div id="dbLevel" style="font-size: 1.2em; margin-top: 10px; color: #007bff;">Ses Seviyesi: -- dB</div>
        <div id="dbBarContainer" style="width: 100%; max-width: 400px; height: 28px; background: #eee; border-radius: 14px; margin: 10px auto 20px auto; box-shadow: 0 2px 8px rgba(0,0,0,0.07);">
          <div id="dbBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, #4caf50 0%, #ffeb3b 60%, #f44336 100%); border-radius: 14px; transition: width 0.2s, background 0.2s;"></div>
        </div>
        <div class="transcript-container">
            <h3 id="transcriptHeader">ğŸ“ KonuÅŸma:</h3>
            <div id="transcript" class="transcript">KonuÅŸma burada gÃ¶rÃ¼necek...</div>
            <div id="sttTime" style="font-size:0.95em;color:#888;margin-top:8px;"></div>
        </div>
        
        <div class="translation-container">
            <h3>ğŸŒ Ã‡eviri:</h3>
            <div id="translation" class="translation">Ã‡eviri burada gÃ¶rÃ¼necek...</div>
            <div id="translationTime" style="font-size:0.95em;color:#888;margin-top:8px;"></div>
        </div>
    </div>

    <script>
        var socket = io();
        var transcriptDiv = document.getElementById('transcript');
        var translationDiv = document.getElementById('translation');
        var startBtn = document.getElementById('startBtn');
        var stopBtn = document.getElementById('stopBtn');
        var statusDiv = document.getElementById('status');
        var detectedLangDiv = document.getElementById('detectedLang');
        var translationTimeDiv = document.getElementById('translationTime');
        var micListBox = document.getElementById('micListBox');
        var transcriptHeader = document.getElementById('transcriptHeader');
        var sttTimeDiv = document.getElementById('sttTime');
        
        var isListening = false;
        var fullTranscript = '';
        var fullTranslation = '';
        
        startBtn.addEventListener('click', function() {
            var targetLang = document.getElementById('targetLang').value;
            var service = document.getElementById('translationService').value;
            
            socket.emit('start_listening', {
                target_lang: targetLang,
                service: service
            });
            
            isListening = true;
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
            statusDiv.className = 'status listening';
            statusDiv.textContent = 'ğŸ¤ Dinleniyor... KonuÅŸun!';
            
            // Temizle
            fullTranscript = '';
            fullTranslation = '';
            transcriptDiv.textContent = 'Dinleniyor...';
            translationDiv.textContent = 'Ã‡eviri bekleniyor...';
            sttTimeDiv.textContent = '';
            translationTimeDiv.textContent = '';
            detectedLangDiv.textContent = '';
            transcriptHeader.textContent = 'ğŸ“ KonuÅŸma:';
        });
        
        stopBtn.addEventListener('click', function() {
            socket.emit('stop_listening');
            isListening = false;
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
            statusDiv.className = 'status stopped';
            statusDiv.textContent = 'â¹ï¸ Dinleme durduruldu.';
        });
        
        socket.on('new_text', function(data) {
            if (isListening) {
                fullTranscript += data.text + ' ';
                transcriptDiv.textContent = fullTranscript;
                if (data.stt_duration) {
                    sttTimeDiv.textContent = 'Ses â†’ Metin sÃ¼resi: ' + (data.stt_duration*1000).toFixed(0) + ' ms';
                }
                if (data.lang) {
                    let langMap = {
                        'tr': 'TÃ¼rkÃ§e',
                        'en': 'Ä°ngilizce',
                        'fr': 'FransÄ±zca',
                        'de': 'Almanca',
                        'es': 'Ä°spanyolca',
                        'it': 'Ä°talyanca',
                        'ru': 'RusÃ§a',
                        'ja': 'Japonca',
                        'ko': 'Korece',
                        'zh': 'Ã‡ince',
                        'ar': 'ArapÃ§a',
                        'tr-TR': 'TÃ¼rkÃ§e',
                        'en-US': 'Ä°ngilizce',
                        'fr-FR': 'FransÄ±zca',
                        'de-DE': 'Almanca',
                        'es-ES': 'Ä°spanyolca',
                        'it-IT': 'Ä°talyanca',
                        'ru-RU': 'RusÃ§a',
                        'ja-JP': 'Japonca',
                        'ko-KR': 'Korece',
                        'zh-CN': 'Ã‡ince',
                        'ar-SA': 'ArapÃ§a'
                    };
                    let langName = langMap[data.lang] || data.lang;
                    transcriptHeader.textContent = `ğŸ“ ${langName} KonuÅŸma:`;
                }
            }
        });
        
        socket.on('translation_result', function(data) {
            if (isListening) {
                fullTranslation += data.translated_text + ' ';
                translationDiv.textContent = fullTranslation;
                if (data.duration) {
                    translationTimeDiv.textContent = 'Ã‡eviri sÃ¼resi: ' + (data.duration*1000).toFixed(0) + ' ms';
                }
            }
        });
        socket.on('detected_language', function(data) {
            if (data.lang) {
                detectedLangDiv.textContent = 'AlgÄ±lanan dil: ' + data.lang;
            }
        });
        socket.on('audio_features', function(data) {
            if (data.db !== undefined && data.db !== null) {
                let db = data.db;
                let dbText = db.toFixed(1);
                document.getElementById('dbLevel').textContent = 'Ses Seviyesi: ' + dbText + ' dB';
                // dB bar gÃ¼ncelle
                // dB aralÄ±ÄŸÄ±: -80 (sessiz) ... 0 (normal konuÅŸma) ... +10~+20 (yÃ¼ksek)
                let minDb = -80, maxDb = 0;
                let percent = Math.max(0, Math.min(1, (db - minDb) / (maxDb - minDb)));
                let bar = document.getElementById('dbBar');
                bar.style.width = (percent * 100) + '%';
                // Renk geÃ§iÅŸi: yeÅŸil (dÃ¼ÅŸÃ¼k) -> sarÄ± (orta) -> kÄ±rmÄ±zÄ± (yÃ¼ksek)
                if (percent < 0.5) {
                    bar.style.background = 'linear-gradient(90deg, #4caf50 0%, #ffeb3b 100%)';
                } else if (percent < 0.85) {
                    bar.style.background = 'linear-gradient(90deg, #ffeb3b 0%, #f44336 100%)';
                } else {
                    bar.style.background = 'linear-gradient(90deg, #f44336 0%, #b71c1c 100%)';
                }
            }
        });

        // Mikrofon listesini iste
        socket.emit('get_microphones');
        socket.on('microphone_list', function(data) {
            if (data.microphones && data.microphones.length > 0) {
                var html = '<b>ğŸ¤ Aktif Mikrofon:</b> ' + data.microphones[data.default_index].name + '<br><b>TÃ¼m Mikrofonlar:</b><ul style="margin:5px 0 0 15px;">';
                data.microphones.forEach(function(mic, i) {
                    html += '<li' + (i === data.default_index ? ' style="color:#1565c0;font-weight:bold;"' : '') + '>' + mic.name + '</li>';
                });
                html += '</ul>';
                micListBox.innerHTML = html;
            } else {
                micListBox.innerHTML = '<span style="color:#c00;">Mikrofon bulunamadÄ±!</span>';
            }
        });
    </script>
</body>
</html> 