<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Buddy Dashboard - Engagement Analytics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dashboard-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .panel-header h3 {
            margin-left: 10px;
            color: #333;
        }

        .panel-header i {
            font-size: 1.5rem;
            color: #667eea;
        }

        /* Engagement Overview */
        .engagement-overview {
            grid-column: span 2;
        }

        .engagement-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .chart-container canvas {
            max-height: 300px;
        }

        /* Real-time Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .metric-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.8rem;
        }

        /* Emotion Analysis */
        .emotion-bars {
            margin-top: 15px;
        }

        .emotion-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .emotion-label {
            width: 80px;
            font-size: 0.9rem;
            color: #495057;
        }

        .emotion-progress {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 0 10px;
            overflow: hidden;
        }

        .emotion-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .emotion-value {
            width: 40px;
            text-align: right;
            font-size: 0.8rem;
            color: #6c757d;
        }

        /* Session History */
        .session-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .session-date {
            font-weight: 600;
            color: #333;
        }

        .session-duration {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            font-size: 0.8rem;
        }

        .session-stat {
            text-align: center;
        }

        .session-stat-value {
            font-weight: bold;
            color: #667eea;
        }

        .session-stat-label {
            color: #6c757d;
        }

        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .control-btn {
            padding: 12px 24px;
            margin: 0 8px 10px 8px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn.primary {
            background: #667eea;
            color: white;
        }

        .control-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .status-indicator.active {
            background: #d4edda;
            color: #155724;
        }

        .status-indicator.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .engagement-overview {
                grid-column: span 1;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .engagement-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Loading states */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #6c757d;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Study Buddy Dashboard</h1>
            <p>Real-time Engagement Analytics & Learning Insights</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">
                ELEC 491 Senior Design Project | Prof. Engin Erzin | Derin Ege Evren
            </p>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div id="dashboardStatus" class="status-indicator inactive">
                <i class="fas fa-circle"></i>
                <span>Dashboard Inactive</span>
            </div>
            
            <button id="refreshDataBtn" class="control-btn primary" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i>
                Refresh Data
            </button>
            
            <button id="exportDataBtn" class="control-btn secondary" onclick="exportData()">
                <i class="fas fa-download"></i>
                Export Data
            </button>
            
            <button id="clearDataBtn" class="control-btn secondary" onclick="clearData()">
                <i class="fas fa-trash"></i>
                Clear Data
            </button>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Engagement Overview -->
            <div class="dashboard-panel engagement-overview">
                <div class="panel-header">
                    <i class="fas fa-heartbeat"></i>
                    <h3>Engagement Overview</h3>
                </div>
                
                <div class="engagement-stats">
                    <div class="stat-card">
                        <div id="avgEngagement" class="stat-value">0.00</div>
                        <div class="stat-label">Average Engagement</div>
                    </div>
                    <div class="stat-card">
                        <div id="totalInteractions" class="stat-value">0</div>
                        <div class="stat-label">Total Interactions</div>
                    </div>
                    <div class="stat-card">
                        <div id="sessionDuration" class="stat-value">0m</div>
                        <div class="stat-label">Session Duration</div>
                    </div>
                    <div class="stat-card">
                        <div id="engagementTrend" class="stat-value">-</div>
                        <div class="stat-label">Engagement Trend</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="engagementChart"></canvas>
                </div>
            </div>

            <!-- Real-time Metrics -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Real-time Metrics</h3>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div id="currentEngagement" class="metric-value">0.500</div>
                        <div class="metric-label">Current Engagement</div>
                    </div>
                    <div class="metric-item">
                        <div id="currentEmotion" class="metric-value">Neutral</div>
                        <div class="metric-label">Current Emotion</div>
                    </div>
                    <div class="metric-item">
                        <div id="voiceEnergy" class="metric-value">0.500</div>
                        <div class="metric-label">Voice Energy</div>
                    </div>
                    <div class="metric-item">
                        <div id="attentionLevel" class="metric-value">0.500</div>
                        <div class="metric-label">Attention Level</div>
                    </div>
                    <div class="metric-item">
                        <div id="responseTime" class="metric-value">0ms</div>
                        <div class="metric-label">Response Time</div>
                    </div>
                    <div class="metric-item">
                        <div id="interactionQuality" class="metric-value">0.500</div>
                        <div class="metric-label">Interaction Quality</div>
                    </div>
                </div>
            </div>

            <!-- Emotion Analysis -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <i class="fas fa-smile"></i>
                    <h3>Emotion Analysis</h3>
                </div>
                
                <div class="chart-container">
                    <canvas id="emotionChart"></canvas>
                </div>
                
                <div class="emotion-bars">
                    <div class="emotion-bar">
                        <div class="emotion-label">Happy</div>
                        <div class="emotion-progress">
                            <div id="happyBar" class="emotion-fill" style="width: 0%; background: #28a745;"></div>
                        </div>
                        <div id="happyValue" class="emotion-value">0%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-label">Neutral</div>
                        <div class="emotion-progress">
                            <div id="neutralBar" class="emotion-fill" style="width: 100%; background: #6c757d;"></div>
                        </div>
                        <div id="neutralValue" class="emotion-value">100%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-label">Sad</div>
                        <div class="emotion-progress">
                            <div id="sadBar" class="emotion-fill" style="width: 0%; background: #dc3545;"></div>
                        </div>
                        <div id="sadValue" class="emotion-value">0%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-label">Angry</div>
                        <div class="emotion-progress">
                            <div id="angryBar" class="emotion-fill" style="width: 0%; background: #fd7e14;"></div>
                        </div>
                        <div id="angryValue" class="emotion-value">0%</div>
                    </div>
                </div>
            </div>

            <!-- Session History -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <i class="fas fa-history"></i>
                    <h3>Session History</h3>
                </div>
                
                <div id="sessionHistory">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Loading session history...</span>
                    </div>
                </div>
            </div>

            <!-- Voice Analysis -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <i class="fas fa-microphone"></i>
                    <h3>Voice Analysis</h3>
                </div>
                
                <div class="chart-container">
                    <canvas id="voiceChart"></canvas>
                </div>
            </div>

            <!-- Learning Insights -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <i class="fas fa-lightbulb"></i>
                    <h3>Learning Insights</h3>
                </div>
                
                <div id="learningInsights">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Analyzing learning patterns...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <script>
        // Socket.IO connection
        const socket = io();
        
        // Chart instances
        let engagementChart, emotionChart, voiceChart;
        
        // Dashboard data
        let dashboardData = {
            engagementHistory: [],
            emotionHistory: [],
            voiceHistory: [],
            sessionHistory: [],
            currentMetrics: {}
        };
        
        // Initialize dashboard
        function initDashboard() {
            setupCharts();
            setupSocketListeners();
            refreshDashboard();
        }
        
        function setupCharts() {
            // Engagement Chart
            const engagementCtx = document.getElementById('engagementChart').getContext('2d');
            engagementChart = new Chart(engagementCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Engagement Score',
                        data: [],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Emotion Chart
            const emotionCtx = document.getElementById('emotionChart').getContext('2d');
            emotionChart = new Chart(emotionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Happy', 'Neutral', 'Sad', 'Angry', 'Surprised', 'Fearful'],
                    datasets: [{
                        data: [0, 100, 0, 0, 0, 0],
                        backgroundColor: [
                            '#28a745',
                            '#6c757d',
                            '#dc3545',
                            '#fd7e14',
                            '#17a2b8',
                            '#6f42c1'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Voice Chart
            const voiceCtx = document.getElementById('voiceChart').getContext('2d');
            voiceChart = new Chart(voiceCtx, {
                type: 'radar',
                data: {
                    labels: ['Energy', 'Pitch', 'Tempo', 'Clarity', 'Consistency'],
                    datasets: [{
                        label: 'Voice Characteristics',
                        data: [0.5, 0.5, 0.5, 0.5, 0.5],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });
        }
        
        function setupSocketListeners() {
            socket.on('connect', function() {
                updateDashboardStatus(true);
            });
            
            socket.on('disconnect', function() {
                updateDashboardStatus(false);
            });
            
            socket.on('engagement_metrics', function(data) {
                updateRealTimeMetrics(data);
                addToHistory('engagement', data);
            });
            
            socket.on('engagement_update', function(data) {
                updateEngagementOverview(data);
            });
        }
        
        function updateDashboardStatus(connected) {
            const statusEl = document.getElementById('dashboardStatus');
            if (connected) {
                statusEl.className = 'status-indicator active';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Dashboard Active</span>';
            } else {
                statusEl.className = 'status-indicator inactive';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Dashboard Inactive</span>';
            }
        }
        
        function updateRealTimeMetrics(data) {
            document.getElementById('currentEngagement').textContent = (data.engagement_score || 0).toFixed(3);
            document.getElementById('currentEmotion').textContent = data.emotion || 'Neutral';
            document.getElementById('voiceEnergy').textContent = (data.voice_energy || 0).toFixed(3);
            document.getElementById('attentionLevel').textContent = (data.attention_level || 0).toFixed(3);
            document.getElementById('responseTime').textContent = Math.round(data.response_time || 0) + 'ms';
            document.getElementById('interactionQuality').textContent = (data.interaction_quality || 0).toFixed(3);
        }
        
        function updateEngagementOverview(data) {
            document.getElementById('currentEngagement').textContent = (data.engagement_score || 0).toFixed(3);
            
            // Update engagement trend
            const trend = data.trend || 'stable';
            const trendEl = document.getElementById('engagementTrend');
            trendEl.textContent = trend.charAt(0).toUpperCase() + trend.slice(1);
            
            // Update engagement level color
            const level = data.level || 'medium';
            trendEl.style.color = level === 'high' ? '#28a745' : 
                                  level === 'medium' ? '#ffc107' : '#dc3545';
        }
        
        function addToHistory(type, data) {
            const timestamp = new Date().toLocaleTimeString();
            
            switch(type) {
                case 'engagement':
                    dashboardData.engagementHistory.push({
                        timestamp: timestamp,
                        score: data.engagement_score,
                        emotion: data.emotion,
                        time: Date.now()
                    });
                    
                    // Update engagement chart
                    updateEngagementChart();
                    break;
                    
                case 'emotion':
                    dashboardData.emotionHistory.push({
                        timestamp: timestamp,
                        emotion: data.emotion,
                        confidence: data.confidence,
                        time: Date.now()
                    });
                    
                    updateEmotionChart();
                    break;
            }
        }
        
        function updateEngagementChart() {
            const recent = dashboardData.engagementHistory.slice(-20);
            engagementChart.data.labels = recent.map(d => d.timestamp);
            engagementChart.data.datasets[0].data = recent.map(d => d.score);
            engagementChart.update('none');
        }
        
        function updateEmotionChart() {
            const recent = dashboardData.emotionHistory.slice(-50);
            const emotionCounts = {};
            
            recent.forEach(d => {
                emotionCounts[d.emotion] = (emotionCounts[d.emotion] || 0) + 1;
            });
            
            const total = recent.length;
            if (total > 0) {
                const emotions = ['happy', 'neutral', 'sad', 'angry', 'surprised', 'fearful'];
                const data = emotions.map(emotion => 
                    ((emotionCounts[emotion] || 0) / total) * 100
                );
                
                emotionChart.data.datasets[0].data = data;
                emotionChart.update('none');
                
                // Update emotion bars
                updateEmotionBars(data);
            }
        }
        
        function updateEmotionBars(data) {
            const emotions = ['happy', 'neutral', 'sad', 'angry'];
            emotions.forEach((emotion, index) => {
                const percentage = data[index] || 0;
                document.getElementById(`${emotion}Bar`).style.width = percentage + '%';
                document.getElementById(`${emotion}Value`).textContent = percentage.toFixed(1) + '%';
            });
        }
        
        function refreshDashboard() {
            // Simulate data refresh
            console.log('Refreshing dashboard data...');
            
            // Request session summary
            socket.emit('get_session_summary');
            socket.emit('get_engagement_summary');
            socket.emit('get_conversation_history');
        }
        
        function exportData() {
            const dataStr = JSON.stringify(dashboardData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `study_buddy_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function clearData() {
            if (confirm('Are you sure you want to clear all dashboard data?')) {
                dashboardData = {
                    engagementHistory: [],
                    emotionHistory: [],
                    voiceHistory: [],
                    sessionHistory: [],
                    currentMetrics: {}
                };
                
                // Reset charts
                engagementChart.data.labels = [];
                engagementChart.data.datasets[0].data = [];
                engagementChart.update();
                
                emotionChart.data.datasets[0].data = [0, 100, 0, 0, 0, 0];
                emotionChart.update();
                
                // Reset displays
                document.getElementById('avgEngagement').textContent = '0.00';
                document.getElementById('totalInteractions').textContent = '0';
                document.getElementById('sessionDuration').textContent = '0m';
                document.getElementById('engagementTrend').textContent = '-';
                
                console.log('Dashboard data cleared');
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>


